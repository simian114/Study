### 2020-11-05

-----
##### 1. 학습 날짜
- 2020-11-05

-----
##### 2. 학습 시간
- 08:00 ~ 20:00

-----
###### 3. 학습 범위 및 주제
- 문제풀이
- 웹서버 설계 및 구현

-----
##### 4. 동료 학습 방법
- slack

-----
##### 5. 학습 목표
- 서버의 동작 방식을 익히고 그에 맞게 설계 및 구현을 한다.
- 문제풀기

-----
##### 6. 과제 제출
- https://github.com/get-Pork-Belly/Webserv
- https://github.com/leecoleecolee/ProblemSolving/tree/sanam

-----
##### 7. 상세 학습 내용
- 문제풀이
    - 슬라이딩 윈도우를 통한 문자열 찾기를 했다. 기본적으로 이런 개념들은 머리속에 들어왔지만, 적재적소에 사용하지 못하는 문제가 있다. 또한 파이썬으로 하다보니깐 어떻게 해서든 간단한 풀이를 찾으려고 애쓰는 거같다. 물론 쉽게 푸는것도 좋지만 문제풀이의 취지인 알고리즘을 더 고려하면서 푸는게 좋을거같다.

- 웹서버
    - CGI 프로그램 실행하는 방법을 익혔다. 우리가 만든 코드가 조금은 복잡하기 때문에 CGI를 테스트 하면서 진행하기에는 조금 무리가 있다고 판단했다. 따라서 전체적인 흐름에 CGI를 맞춰서 구현하지 않고 일단 실행만 가능하게 코드를 짰다. 이렇게 코드를 짜는데도 정말 많은 시간이 소모됐다. 일반 어려웠던 부분을 꼽자면, CGI에 meta variable을 보내는 부분에서 부터 꼬였다. CGI에 request 를 보내는데는 두 가지 방법이 존재하는데, 첫 번째는 body로 보내는 것 두 번째는 meta variable 형태로 보내는 것이다. 직접(무조건) 구현해야 하는 meta varibles는 총 16개다. rfc를 보고 구현을 했지만 역시나 제대로 실행되지 않고 계속 헛돌기만 했다. 결국 알게된 것은 우리가 cgi를 판단하는 것부터 틀려먹었다는 것이다.
    - 일단은 실행만 가능하게 만들었기 때문에 우리가 지금까지 구현한 웹서버의 흐름에 맞게 cgi 실행 부분을 껴 맞춰야한다. 이 부분에서도 애로사항이 많을 거 같다. 왜냐하면 우리의 서버는 모든 read, write 에 대해서 select를 거치게했기 때문이다. CGI는 CGI에 데이터를 보내는 과정(write) 그리고 데이터를 받아오는 과정(read) 의 두 부분이 포함되기 때문에 분기르 두 개나 더해줘야 하는 대작업을해야한다. 기본적으로 머릿속에는 어떻게 하면 좋을지에 대해 그림은 그려져있지만,.... 이걸 구현하는 것은 정말로 어려워보인다.
    - 먼저 isOpenCGI에서 CGI로 작업이 들어오면 여기서 pipe를 열어준다. 그리고 나서 fork 를 해주자. 이 때 데이터를 CGI로 전송해야 하기 때문에(WRITE) 플래그를 세워주자. 이렇게 write 플래그가 세워진다면 다음번 select에서 write에 걸리게 되고 CGI로 데이터가 전송된다. 이 때 주의할 것은 데이터가 한번에 보내지지 않고 여러 번에 걸쳐서 보내질 수 있다는 점이다. 만약 데이터가 전부 보내지지 않았다면 한번의 write를 더 해야한다. 기억하자. 자 이렇게 데이터가 모두 전송되었다고 보장이 된다면, CGI에다가 EOF 라는 시그널을 보내자. 시그널은 꼭 보낼 필요는 없어 보인다. 하지만 CGI에 request 를 보내는 과정에서 마지막에 EOF가 없었다면 CGI는 데이터의 끝을 알아보지 못하고 계속 데이터를 기다린다 즉 블록에 빠진다.
    - 이렇게 write가 끝나면 CGI 프로세스(자식프로세스)는 자신의 작업을 한다. 그리고 자신의 작업이 끝난다면 데이터를 부모프로세스로 전송해줄것이다. 이 전송이란 것은 STDOUT을 통해서 전송된다. 따라서 dup 를 통해 STDOUT으로 출력되는 데이터들을 우리가 원하는 FD로 받아야한다. 아마 이 작업도 한번에 끝나는게 아니라 여러번에 걸쳐서 될 수 있기 때문에 이 부분에 대해서도 신경을 써야한다.
    - 자 이제 read까지 끝났다고 하자 그러면 PIPE FD 와 연결되어 있는 CLIENT FD 의 WRITE 을 열어주자. 그리고 response 메시지를 만들고 보내자.
    - 말로는 쉽지...



 -----
##### 8. 오늘 학습 내용에 대한 개인적인 총평
- 오늘의 나도 역시나 멍청하다.


-----

##### 9. 다음 학습 계획

- 웹서버 설계 및 구현
- 문제풀이
