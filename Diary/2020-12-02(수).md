### 2020-12-02

-----
##### 1. 학습 날짜
- 2020-12-02

-----
##### 2. 학습 시간
- 09:00 ~ 20:00

-----
###### 3. 학습 범위 및 주제
- 웹서버 설계 및 구현

-----
##### 4. 동료 학습 방법
- slack

-----
##### 5. 학습 목표
- 서버의 동작 방식을 익히고 그에 맞게 설계 및 구현을 한다.

-----
##### 6. 과제 제출
- https://github.com/get-Pork-Belly/Webserv

-----
##### 7. 상세 학습 내용

-  웹서버
    - 이제 거의 다 끝났다. 정말 마무리 작업만 남았다. 하지만 그래도 할게 너무 많은것 같은 느낌이다... 왜냐하면 하나를 수정하면 수정한 것과 의존성을 갖는 다른 코드를 모두 수정해야하기 때문이다. 어제 오전에 URI의 퍼센트 디코딩을 했는데 확인해보니깐 퍼센트 인코딩으로 인해서 URI에 공백이 들어올 수 있게 되었고 기존에 공백을 기준으로 split 하고 autoindex를 만들던 구조 자체를 바꿔야 하는 상황이 도래했다... 
    - 위의 문제는 방금 발견한 문제고 오늘 내가 수정한 것은, 테스터를 돌릴 떄 처음 돌릴 때는 반드시 성공하는데 두 번째 부터는 테스터의 특정 부분에서 반드시 터지는 문제였다. 이 문제를 해결하지 못해서 끙끙대다 발견한 게 기존에 만들었던 time out 문제다. time out은 그에 해당하는 fd가 종료되거나 메시지가 모두 전달 되었을 때, client_socket을 닫을 때 모두 초기화가 되는 줄 알았는데..? client가 닫힐 때는 client의 fd에 대해서만 timeout을 초기화 한다. 즉 client_fd가 아니었던 pipe_fd, resource_fd 등은 초기화가 되지 않는 상태였고 그런 상태로 두 번쩨 테스터를 돌리면 이미 시간은 out이 되어있으므로 반드시 터질 수 밖에 없었던 것. 이 문제는 솔직히 나는 감도 잡지 못하고 그냥 테스터만 여러번 톨려봤었다... 그러다가 내가 고장나는 fd는 반드시 짝수라는 것을 알아냈고 팀동료의 혜안으로 pipe_fd 가 닫힐 때 monitor_time_out이 초기화가 되지 않는다는 사실을  알아냈다.
    - ServerGenerator 수정
        - 서버제너레이터는 이 과제의 정말 정말 초창기 떄 설계하고 구현했던 클래스다. 정말로 오랜만에 봤는데 이 클래스는 정말 모든게 문제였다. 클래스의 구조, 멤버 변수 또는 멤버 함수의 이름 그리고 세세한 코딩까지... 정말 눈을 뜨고 쳐다볼 수 없는 코드다. 이 프로젝트에서 이 설정 파일에 대한 부분은 중요한 파트가 아니라서 이렇게 만들었다고는 하지만 하.. 내가 너무 한심하다. 일단 지금은 서버가 터지지 않고 돌아가게 만드는 것이 목표이므로 리팩토링은 뒤로 미루고 터지지 않게만 수정했다.

    - PHP-CGI
        - 오늘 PHP_CGI를 최정적으로 어떻게 할지에 대해 확실히 정했다. php-cgi는 php 로 만들어진 cgi-script를 실행시키는 데 사용될 것이다. 만약 php 스크립트가 아니라면 요청된 그 스크립트가 바로 자식 프로세스로 만들어지고 실행될 것이다. 
-----

##### 8. 오늘 학습 내용에 대한 개인적인 총평
- 웹서버 정말 너무 방대한 분량이다. 하지만 양이 많은 만큼 배우는 것도 많다. 이 순간을 즐기자.

-----

##### 9. 다음 학습 계획

- 웹서버 설계 및 구현
